<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Benchmarking <sup>1</sup>
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="F# DependentTypes"/>
    <meta name="author" content="Robert Kuzelj, Jack Fox"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/DependentTypes/content/style.css" />
    <script type="text/javascript" src="/DependentTypes/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://github.com/jackfoxy/DependentTypes">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/DependentTypes/index.html">DependentTypes</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Benchmarking-sup-1-sup" class="anchor" href="#Benchmarking-sup-1-sup">Benchmarking <sup>1</sup></a></h1>
<p>Let's benchmark...</p>
<h2><a name="DependentType-option" class="anchor" href="#DependentType-option">DependentType option</a></h2>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 3)" onmouseover="showTip(event, 'fs1', 3)" class="id">DependentTypes</span>

<span class="k">module</span> <span class="m">PercentType</span> <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="fn">validatePercent</span> <span class="id">_</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="id">n</span> <span class="pn">:</span> <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="vt">float</span><span class="pn">)</span> <span class="o">=</span> 
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="id">n</span> <span class="o">&gt;</span><span class="o">=</span> <span class="n">0.</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs4', 8)" onmouseover="showTip(event, 'fs4', 8)" class="id">n</span> <span class="o">&lt;=</span> <span class="n">1.</span> <span class="k">with</span>
        <span class="pn">|</span> <span class="k">true</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs6', 9)" onmouseover="showTip(event, 'fs6', 9)" class="uc">Some</span> <span onmouseout="hideTip(event, 'fs4', 10)" onmouseover="showTip(event, 'fs4', 10)" class="id">n</span>
        <span class="pn">|</span> <span class="k">false</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs7', 11)" onmouseover="showTip(event, 'fs7', 11)" class="uc">None</span>

    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs8', 12)" onmouseover="showTip(event, 'fs8', 12)" class="rt">PercentValidator</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span> 
        <span class="k">inherit</span> <span onmouseout="hideTip(event, 'fs9', 13)" onmouseover="showTip(event, 'fs9', 13)" class="rt">PiType</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="rt">unit</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs5', 15)" onmouseover="showTip(event, 'fs5', 15)" class="vt">float</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs5', 16)" onmouseover="showTip(event, 'fs5', 16)" class="vt">float</span> <span onmouseout="hideTip(event, 'fs11', 17)" onmouseover="showTip(event, 'fs11', 17)" class="rt">option</span><span class="pn">&gt;</span><span class="pn">(</span><span class="pn">(</span><span class="pn">)</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs3', 18)" onmouseover="showTip(event, 'fs3', 18)" class="fn">validatePercent</span><span class="pn">)</span>

    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs12', 19)" onmouseover="showTip(event, 'fs12', 19)" class="rt">PairPercentValidator</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span> 
        <span class="k">inherit</span> <span onmouseout="hideTip(event, 'fs13', 20)" onmouseover="showTip(event, 'fs13', 20)" class="rt">SigmaType</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs10', 21)" onmouseover="showTip(event, 'fs10', 21)" class="rt">unit</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs5', 22)" onmouseover="showTip(event, 'fs5', 22)" class="vt">float</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs5', 23)" onmouseover="showTip(event, 'fs5', 23)" class="vt">float</span> <span onmouseout="hideTip(event, 'fs11', 24)" onmouseover="showTip(event, 'fs11', 24)" class="rt">option</span><span class="pn">&gt;</span><span class="pn">(</span><span class="pn">(</span><span class="pn">)</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs3', 25)" onmouseover="showTip(event, 'fs3', 25)" class="fn">validatePercent</span><span class="pn">)</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs14', 26)" onmouseover="showTip(event, 'fs14', 26)" class="rt">Percent</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs15', 27)" onmouseover="showTip(event, 'fs15', 27)" class="rt">DependentType</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs16', 28)" onmouseover="showTip(event, 'fs16', 28)" class="m">PercentType</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs17', 29)" onmouseover="showTip(event, 'fs17', 29)" class="id">PercentValidator</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs10', 30)" onmouseover="showTip(event, 'fs10', 30)" class="rt">unit</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs5', 31)" onmouseover="showTip(event, 'fs5', 31)" class="vt">float</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs5', 32)" onmouseover="showTip(event, 'fs5', 32)" class="vt">float</span> <span onmouseout="hideTip(event, 'fs11', 33)" onmouseover="showTip(event, 'fs11', 33)" class="rt">option</span><span class="pn">&gt;</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs18', 34)" onmouseover="showTip(event, 'fs18', 34)" class="rt">PctOption</span> <span class="o">=</span> <span class="pn">{</span> <span onmouseout="hideTip(event, 'fs19', 35)" onmouseover="showTip(event, 'fs19', 35)" class="id">Pct</span> <span class="pn">:</span> <span onmouseout="hideTip(event, 'fs5', 36)" onmouseover="showTip(event, 'fs5', 36)" class="vt">float</span> <span onmouseout="hideTip(event, 'fs11', 37)" onmouseover="showTip(event, 'fs11', 37)" class="rt">option</span> <span class="pn">}</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs20', 38)" onmouseover="showTip(event, 'fs20', 38)" class="rt">DependentTypePctOption</span> <span class="o">=</span> <span class="pn">{</span> <span onmouseout="hideTip(event, 'fs21', 39)" onmouseover="showTip(event, 'fs21', 39)" class="id">Pct</span> <span class="pn">:</span> <span onmouseout="hideTip(event, 'fs14', 40)" onmouseover="showTip(event, 'fs14', 40)" class="rt">Percent</span> <span onmouseout="hideTip(event, 'fs11', 41)" onmouseover="showTip(event, 'fs11', 41)" class="rt">option</span> <span class="pn">}</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 42)" onmouseover="showTip(event, 'fs22', 42)" class="fn">runPctOption</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span>
    <span class="pn">[|</span>
        <span class="pn">{</span><span onmouseout="hideTip(event, 'fs18', 43)" onmouseover="showTip(event, 'fs18', 43)" class="rt">PctOption</span><span class="pn">.</span><span class="id">Pct</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs16', 44)" onmouseover="showTip(event, 'fs16', 44)" class="m">PercentType</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs3', 45)" onmouseover="showTip(event, 'fs3', 45)" class="id">validatePercent</span> <span class="pn">(</span><span class="pn">)</span> <span class="n">0.5</span><span class="pn">}</span>
        <span class="pn">{</span><span onmouseout="hideTip(event, 'fs18', 46)" onmouseover="showTip(event, 'fs18', 46)" class="rt">PctOption</span><span class="pn">.</span><span class="id">Pct</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs16', 47)" onmouseover="showTip(event, 'fs16', 47)" class="m">PercentType</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs3', 48)" onmouseover="showTip(event, 'fs3', 48)" class="id">validatePercent</span> <span class="pn">(</span><span class="pn">)</span> <span class="n">2.5</span><span class="pn">}</span>
    <span class="pn">|]</span> 

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs23', 49)" onmouseover="showTip(event, 'fs23', 49)" class="fn">runLiftedPctDependentType</span><span class="pn">(</span><span class="pn">)</span> <span class="o">=</span>
    <span class="pn">[|</span>
        <span class="pn">{</span><span onmouseout="hideTip(event, 'fs20', 50)" onmouseover="showTip(event, 'fs20', 50)" class="rt">DependentTypePctOption</span><span class="pn">.</span><span class="id">Pct</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 51)" onmouseover="showTip(event, 'fs14', 51)" class="rt">Percent</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs24', 52)" onmouseover="showTip(event, 'fs24', 52)" class="id">TryCreate</span> <span class="n">0.5</span><span class="pn">}</span>
        <span class="pn">{</span><span onmouseout="hideTip(event, 'fs20', 53)" onmouseover="showTip(event, 'fs20', 53)" class="rt">DependentTypePctOption</span><span class="pn">.</span><span class="id">Pct</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 54)" onmouseover="showTip(event, 'fs14', 54)" class="rt">Percent</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs24', 55)" onmouseover="showTip(event, 'fs24', 55)" class="id">TryCreate</span> <span class="n">2.5</span><span class="pn">}</span>
    <span class="pn">|]</span> 
</code></pre></td>
</tr>
</table>
<p>We benchmark creating a percent DependentType option against creating a simple float option using the same validation logic. Each benchmark instance creates 1 Some option and 1 None option in both cases.
We benchmark 1,000,000 instances, hence 2M option instances.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">validated</span> <span onmouseout="hideTip(event, 'fs11', 56)" onmouseover="showTip(event, 'fs11', 56)" class="id">option</span> <span class="id">is</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">TryCreate</span> <span class="id">DependentType</span> <span onmouseout="hideTip(event, 'fs11', 57)" onmouseover="showTip(event, 'fs11', 57)" class="id">option</span><span class="pn">.</span> 
<span class="id">f1</span> <span class="pn">(</span><span class="n">36.2342</span> <span class="n">&#177;</span> <span class="n">2.7402</span> <span class="id">ms</span><span class="pn">)</span> <span class="id">is</span> <span class="k">~</span><span class="n">95</span><span class="o">%</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">f2</span> <span class="pn">(</span><span class="n">689.8306</span> <span class="n">&#177;</span> <span class="n">30.1484</span> <span class="id">ms</span><span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<p>Not surprisingly validation and creation of a simple option is faster, 19X faster.</p>
<p>And it scales linearly, as we see when executing the benchmark 10X.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="pn">(</span><span class="n">10X</span><span class="pn">)</span> <span class="id">validated</span> <span onmouseout="hideTip(event, 'fs11', 58)" onmouseover="showTip(event, 'fs11', 58)" class="id">option</span> <span class="id">is</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">TryCreate</span> <span class="id">DependentType</span> <span onmouseout="hideTip(event, 'fs11', 59)" onmouseover="showTip(event, 'fs11', 59)" class="id">option</span><span class="pn">.</span> 
<span class="id">f1</span> <span class="pn">(</span><span class="n">0.0007</span> <span class="n">&#177;</span> <span class="n">0.0000</span> <span class="id">ms</span><span class="pn">)</span> <span class="id">is</span> <span class="k">~</span><span class="n">95</span><span class="o">%</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">f2</span> <span class="pn">(</span><span class="n">0.0128</span> <span class="n">&#177;</span> <span class="n">0.0015</span> <span class="id">ms</span><span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<p>Considering in our first benchmark Dependent type created 2M option instances in less than 700 ms, and creates 10 in a fraction of a millisecond, this is probably acceptable performance for all but the most
demanding network applications.</p>
<p>The validation logic adds little overhead. Even comparing creating DependentType to "naked" options (not run through the validation logic) makes little difference in the performance ratio.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">naked</span> <span onmouseout="hideTip(event, 'fs11', 60)" onmouseover="showTip(event, 'fs11', 60)" class="id">option</span> <span class="id">is</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">TryCreate</span> <span class="id">DependentType</span> <span onmouseout="hideTip(event, 'fs11', 61)" onmouseover="showTip(event, 'fs11', 61)" class="id">option</span><span class="pn">.</span> 
<span class="id">f1</span> <span class="pn">(</span><span class="n">35.9181</span> <span class="n">&#177;</span> <span class="n">1.4791</span> <span class="id">ms</span><span class="pn">)</span> <span class="id">is</span> <span class="k">~</span><span class="n">95</span><span class="o">%</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">f2</span> <span class="pn">(</span><span class="n">697.0493</span> <span class="n">&#177;</span> <span class="n">36.7884</span> <span class="id">ms</span><span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<p>Can we squeeze even more performance from DependentType creation? Let's use <code>Create</code> instead of <code>TryCreate</code> so we eliminate the overhead of "lifting" the <code>'T2</code> base type element option result
to the DependentType element.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">validated</span> <span onmouseout="hideTip(event, 'fs11', 62)" onmouseover="showTip(event, 'fs11', 62)" class="id">option</span> <span class="id">is</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">Create</span> <span class="id">DependentType</span><span class="pn">.</span> 
<span class="id">f1</span> <span class="pn">(</span><span class="n">36.6164</span> <span class="n">&#177;</span> <span class="n">3.0847</span> <span class="id">ms</span><span class="pn">)</span> <span class="id">is</span> <span class="k">~</span><span class="n">87</span><span class="o">%</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">f2</span> <span class="pn">(</span><span class="n">283.1149</span> <span class="n">&#177;</span> <span class="n">7.6188</span> <span class="id">ms</span><span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<p>Now validate option is less than 8X faster, so the "lift" overhead is noticeable at large scales (2M creations).</p>
<p>Consuming (reading) benchmarks reveals far less performance difference.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs25', 63)" onmouseover="showTip(event, 'fs25', 63)" class="fn">readDependentType</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs26', 64)" onmouseover="showTip(event, 'fs26', 64)" class="id">xs</span> <span class="pn">:</span> <span onmouseout="hideTip(event, 'fs20', 65)" onmouseover="showTip(event, 'fs20', 65)" class="rt">DependentTypePctOption</span><span class="pn">[</span><span class="pn">]</span><span class="pn">)</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs26', 66)" onmouseover="showTip(event, 'fs26', 66)" class="id">xs</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs27', 67)" onmouseover="showTip(event, 'fs27', 67)" class="m">Array</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs28', 68)" onmouseover="showTip(event, 'fs28', 68)" class="id">map</span> <span class="pn">(</span> <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs29', 69)" onmouseover="showTip(event, 'fs29', 69)" class="id">x</span> <span class="k">-&gt;</span>
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs29', 70)" onmouseover="showTip(event, 'fs29', 70)" class="id">x</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs21', 71)" onmouseover="showTip(event, 'fs21', 71)" class="id">Pct</span> <span class="k">with</span>
        <span class="pn">|</span> <span onmouseout="hideTip(event, 'fs6', 72)" onmouseover="showTip(event, 'fs6', 72)" class="uc">Some</span> <span class="id">_</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs6', 73)" onmouseover="showTip(event, 'fs6', 73)" class="uc">Some</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs30', 74)" onmouseover="showTip(event, 'fs30', 74)" class="fn">someValue</span> <span onmouseout="hideTip(event, 'fs29', 75)" onmouseover="showTip(event, 'fs29', 75)" class="id">x</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs21', 76)" onmouseover="showTip(event, 'fs21', 76)" class="id">Pct</span><span class="pn">)</span>
        <span class="pn">|</span> <span onmouseout="hideTip(event, 'fs7', 77)" onmouseover="showTip(event, 'fs7', 77)" class="uc">None</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs7', 78)" onmouseover="showTip(event, 'fs7', 78)" class="uc">None</span> <span class="pn">)</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 79)" onmouseover="showTip(event, 'fs31', 79)" class="fn">readVanillaOption</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs32', 80)" onmouseover="showTip(event, 'fs32', 80)" class="id">xs</span> <span class="pn">:</span> <span onmouseout="hideTip(event, 'fs18', 81)" onmouseover="showTip(event, 'fs18', 81)" class="rt">PctOption</span><span class="pn">[</span><span class="pn">]</span><span class="pn">)</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs32', 82)" onmouseover="showTip(event, 'fs32', 82)" class="id">xs</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs27', 83)" onmouseover="showTip(event, 'fs27', 83)" class="m">Array</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs28', 84)" onmouseover="showTip(event, 'fs28', 84)" class="id">map</span> <span class="pn">(</span> <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs33', 85)" onmouseover="showTip(event, 'fs33', 85)" class="id">x</span> <span class="k">-&gt;</span>
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs33', 86)" onmouseover="showTip(event, 'fs33', 86)" class="id">x</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs19', 87)" onmouseover="showTip(event, 'fs19', 87)" class="id">Pct</span> <span class="k">with</span>
        <span class="pn">|</span> <span onmouseout="hideTip(event, 'fs6', 88)" onmouseover="showTip(event, 'fs6', 88)" class="uc">Some</span> <span onmouseout="hideTip(event, 'fs34', 89)" onmouseover="showTip(event, 'fs34', 89)" class="id">pct</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs6', 90)" onmouseover="showTip(event, 'fs6', 90)" class="uc">Some</span> <span onmouseout="hideTip(event, 'fs34', 91)" onmouseover="showTip(event, 'fs34', 91)" class="id">pct</span>
        <span class="pn">|</span> <span onmouseout="hideTip(event, 'fs7', 92)" onmouseover="showTip(event, 'fs7', 92)" class="uc">None</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs7', 93)" onmouseover="showTip(event, 'fs7', 93)" class="uc">None</span> <span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">read</span> <span onmouseout="hideTip(event, 'fs35', 94)" onmouseover="showTip(event, 'fs35', 94)" class="id">Option</span> <span class="id">is</span> <span class="id">faster</span> <span class="id">than</span> <span onmouseout="hideTip(event, 'fs35', 95)" onmouseover="showTip(event, 'fs35', 95)" class="id">Option</span> <span class="id">DependentType</span><span class="pn">.</span> 
<span class="id">f1</span> <span class="pn">(</span><span class="n">32.1449</span> <span class="n">&#177;</span> <span class="n">1.4134</span> <span class="id">ms</span><span class="pn">)</span> <span class="id">is</span> <span class="k">~</span><span class="n">35</span><span class="o">%</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">f2</span> <span class="pn">(</span><span class="n">49.8144</span> <span class="n">&#177;</span> <span class="n">0.7834</span> <span class="id">ms</span><span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<p>Very little practical difference, and even less if we substitute the verbose <code>Some pct.Value.Value</code> for the helper function <code>someValue</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">read</span> <span onmouseout="hideTip(event, 'fs35', 96)" onmouseover="showTip(event, 'fs35', 96)" class="id">Option</span> <span class="id">is</span> <span class="id">faster</span> <span class="id">than</span> <span onmouseout="hideTip(event, 'fs35', 97)" onmouseover="showTip(event, 'fs35', 97)" class="id">Option</span> <span class="id">DependentType</span> <span class="id">Value</span><span class="pn">.</span><span class="id">Value</span><span class="pn">.</span> 
<span class="id">f1</span> <span class="pn">(</span><span class="n">24.0376</span> <span class="n">&#177;</span> <span class="n">0.4967</span> <span class="id">ms</span><span class="pn">)</span> <span class="id">is</span> <span class="k">~</span><span class="n">12</span><span class="o">%</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">f2</span> <span class="pn">(</span><span class="n">27.3507</span> <span class="n">&#177;</span> <span class="n">0.6477</span> <span class="id">ms</span><span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<h2><a name="UtcDateTime-DependentType" class="anchor" href="#UtcDateTime-DependentType">UtcDateTime DependentType</a></h2>
<p>Finally, benchmarking a type that is not an <code>option</code>, we compare UtcDateTime in the DomainLib to an implementation validating a DateTime. This time 1M benchmark runs is also 1M instances.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">validated</span> <span class="id">DateTime</span> <span class="id">is</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">Create</span> <span class="id">DependentType</span> <span class="id">DateTime</span><span class="pn">.</span> 
<span class="id">f1</span> <span class="pn">(</span><span class="n">298.8211</span> <span class="n">&#177;</span> <span class="n">2.7119</span> <span class="id">ms</span><span class="pn">)</span> <span class="id">is</span> <span class="k">~</span><span class="n">31</span><span class="o">%</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">f2</span> <span class="pn">(</span><span class="n">431.3628</span> <span class="n">&#177;</span> <span class="n">8.9104</span> <span class="id">ms</span><span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="id">read</span> <span class="id">DateTime</span> <span class="id">is</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">DependentType</span> <span class="id">DateTime</span><span class="pn">.</span> 
<span class="id">f1</span> <span class="pn">(</span><span class="n">312.0462</span> <span class="n">&#177;</span> <span class="n">3.9815</span> <span class="id">ms</span><span class="pn">)</span> <span class="id">is</span> <span class="k">~</span><span class="n">28</span><span class="o">%</span> <span class="id">faster</span> <span class="id">than</span> <span class="id">f2</span> <span class="pn">(</span><span class="n">433.5667</span> <span class="n">&#177;</span> <span class="n">10.5693</span> <span class="id">ms</span><span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<sup>1</sup> For those following along from home, you must manually run the benchmark tests. They do not run as part of the build process. The usual caveats about benchmarking apply. You should benchmark
your own situation on your own system, etc. There is variance in running the benchmarks multiple times. The variance I saw was typically
in absolute run time for each scenario, and not so much in the DependentType / control run time ratios. By and large these results are representative of typical benchmark runs. 

<div class="tip" id="fs1">namespace DependentTypes</div>
<div class="tip" id="fs2">module Helpers<br /><br />from DependentTypes</div>
<div class="tip" id="fs3">val validatePercent : &#39;a -&gt; n:float -&gt; float option</div>
<div class="tip" id="fs4">val n : float</div>
<div class="tip" id="fs5">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />--------------------<br />type float = System.Double<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float</div>
<div class="tip" id="fs6">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs7">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs8">Multiple items<br />type PercentValidator =<br />&#160;&#160;inherit PiType&lt;unit,float,float option&gt;<br />&#160;&#160;new : unit -&gt; PercentValidator<br /><br />--------------------<br />new : unit -&gt; PercentValidator</div>
<div class="tip" id="fs9">Multiple items<br />type PiType&lt;&#39;Config,&#39;T,&#39;T2&gt; =<br />&#160;&#160;new : config:&#39;Config * pi:(&#39;Config -&gt; &#39;T -&gt; &#39;T2) -&gt; PiType&lt;&#39;Config,&#39;T,&#39;T2&gt;<br />&#160;&#160;member Create : x:&#39;T -&gt; &#39;T2<br /><br />--------------------<br />new : config:&#39;Config * pi:(&#39;Config -&gt; &#39;T -&gt; &#39;T2) -&gt; PiType&lt;&#39;Config,&#39;T,&#39;T2&gt;</div>
<div class="tip" id="fs10">type unit = Unit</div>
<div class="tip" id="fs11">type &#39;T option = Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs12">Multiple items<br />type PairPercentValidator =<br />&#160;&#160;inherit SigmaType&lt;unit,float,float option&gt;<br />&#160;&#160;new : unit -&gt; PairPercentValidator<br /><br />--------------------<br />new : unit -&gt; PairPercentValidator</div>
<div class="tip" id="fs13">Multiple items<br />type SigmaType&lt;&#39;Config,&#39;T,&#39;T2&gt; =<br />&#160;&#160;new : config:&#39;Config * pi:(&#39;Config -&gt; &#39;T -&gt; &#39;T2) -&gt; SigmaType&lt;&#39;Config,&#39;T,&#39;T2&gt;<br />&#160;&#160;member Create : x:&#39;T -&gt; &#39;T * &#39;T2<br /><br />--------------------<br />new : config:&#39;Config * pi:(&#39;Config -&gt; &#39;T -&gt; &#39;T2) -&gt; SigmaType&lt;&#39;Config,&#39;T,&#39;T2&gt;</div>
<div class="tip" id="fs14">type Percent = DependentType&lt;PercentType.PercentValidator,unit,float,float option&gt;</div>
<div class="tip" id="fs15">Multiple items<br />union case DependentType.DependentType: &#39;T2 -&gt; DependentType&lt;&#39;PiType,&#39;Config,&#39;T,&#39;T2&gt;<br /><br />--------------------<br />type DependentType&lt;&#39;PiType,&#39;Config,&#39;T,&#39;T2 (requires &#39;PiType :&gt; PiType&lt;&#39;Config,&#39;T,&#39;T2&gt; and default constructor)&gt; =<br />&#160;&#160;| DependentType of &#39;T2<br />&#160;&#160;&#160;&#160;override ToString : unit -&gt; string<br />&#160;&#160;&#160;&#160;member Value : &#39;T2<br />&#160;&#160;&#160;&#160;static member ConvertTo : x:DependentType&lt;&#39;x,&#39;y,&#39;q,&#39;r&gt; -&gt; DependentType&lt;&#39;a,&#39;b,&#39;r,&#39;s&gt; (requires &#39;x :&gt; PiType&lt;&#39;y,&#39;q,&#39;r&gt; and default constructor and &#39;a :&gt; PiType&lt;&#39;b,&#39;r,&#39;s&gt; and default constructor)<br />&#160;&#160;&#160;&#160;static member Create : x:&#39;T -&gt; DependentType&lt;&#39;PiType,&#39;Config,&#39;T,&#39;T2&gt;<br />&#160;&#160;&#160;&#160;static member Extract : x:DependentType&lt;&#39;PiType,&#39;Config,&#39;T,&#39;T2&gt; -&gt; &#39;T2<br />&#160;&#160;&#160;&#160;static member TryCreate : x:Option&lt;&#39;T&gt; -&gt; Option&lt;DependentType&lt;&#39;PiType,&#39;Config,&#39;T,&#39;T2&gt;&gt;<br />&#160;&#160;&#160;&#160;static member TryCreate : x:&#39;T -&gt; Option&lt;DependentType&lt;&#39;PiType,&#39;Config,&#39;T,&#39;T2&gt;&gt;</div>
<div class="tip" id="fs16">module PercentType<br /><br />from Article</div>
<div class="tip" id="fs17">Multiple items<br />type PercentValidator =<br />&#160;&#160;inherit PiType&lt;unit,float,float option&gt;<br />&#160;&#160;new : unit -&gt; PercentValidator<br /><br />--------------------<br />new : unit -&gt; PercentType.PercentValidator</div>
<div class="tip" id="fs18">type PctOption =<br />&#160;&#160;{Pct: float option;}</div>
<div class="tip" id="fs19">PctOption.Pct: float option</div>
<div class="tip" id="fs20">type DependentTypePctOption =<br />&#160;&#160;{Pct: Percent option;}</div>
<div class="tip" id="fs21">DependentTypePctOption.Pct: Percent option</div>
<div class="tip" id="fs22">val runPctOption : unit -&gt; PctOption []</div>
<div class="tip" id="fs23">val runLiftedPctDependentType : unit -&gt; DependentTypePctOption []</div>
<div class="tip" id="fs24">static member DependentType.TryCreate : x:Option&lt;&#39;T&gt; -&gt; Option&lt;DependentType&lt;&#39;PiType,&#39;Config,&#39;T,&#39;T2&gt;&gt;<br />static member DependentType.TryCreate : x:&#39;T -&gt; Option&lt;DependentType&lt;&#39;PiType,&#39;Config,&#39;T,&#39;T2&gt;&gt;</div>
<div class="tip" id="fs25">val readDependentType : xs:DependentTypePctOption [] -&gt; float option []</div>
<div class="tip" id="fs26">val xs : DependentTypePctOption []</div>
<div class="tip" id="fs27">module Array<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs28">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; array:&#39;T [] -&gt; &#39;U []</div>
<div class="tip" id="fs29">val x : DependentTypePctOption</div>
<div class="tip" id="fs30">val someValue : x:Option&lt;&#39;S&gt; -&gt; &#39;T (requires member Extract)</div>
<div class="tip" id="fs31">val readVanillaOption : xs:PctOption [] -&gt; float option []</div>
<div class="tip" id="fs32">val xs : PctOption []</div>
<div class="tip" id="fs33">val x : PctOption</div>
<div class="tip" id="fs34">val pct : float</div>
<div class="tip" id="fs35">module Option<br /><br />from Microsoft.FSharp.Core</div>

        </div>
        <div class="span3">
          <img src="/DependentTypes/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">DependentTypes</li>
            <li><a href="/DependentTypes/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/DependentTypes">Get Library via NuGet</a></li>
            <li><a href="https://github.com/jackfoxy/DependentTypes">Source Code on GitHub</a></li>
            <li><a href="/DependentTypes/license.html">License</a></li>
            <li><a href="/DependentTypes/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/DependentTypes/tutorial.html">Tutorial</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="/DependentTypes/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="https://github.com/jackfoxy/DependentTypes"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
